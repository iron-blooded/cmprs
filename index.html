<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Player</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            min-height: 100vh;
        }
        video {
            width: 80%;
            max-width: 800px;
            margin-top: 20px;
        }
        .error {
            color: red;
            margin: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Video Player</h1>
    <div id="player"></div>

    <script>
        // Новый способ извлечения URL с параметрами
        function getVideoUrl() {
            const search = window.location.search;
            
            // Регулярное выражение для поиска параметра url= с любыми символами до следующего &
            const urlMatch = search.match(/[?&]url=(.*)/);
            
            if (!urlMatch) return null;
            
            try {
                // Двойное декодирование для случаев, когда URL уже был закодирован
                return decodeURIComponent(urlMatch[1].replace(/\+/g, ' '));
            } catch(e) {
                console.error('Error decoding URL:', e);
                return null;
            }
        }

        const videoUrl = getVideoUrl();
        const playerContainer = document.getElementById('player');

        if (videoUrl) {
            // Проверка валидности URL
            try {
                new URL(videoUrl);
            } catch(e) {
                const error = document.createElement('div');
                error.className = 'error';
                error.textContent = 'Некорректный формат URL видео';
                playerContainer.appendChild(error);
                throw e;
            }

            // Создание видео элемента (остальное без изменений)
            const video = document.createElement('video');
            video.controls = true;
            video.style.backgroundColor = '#000';
            
            const source = document.createElement('source');
            source.src = videoUrl;
            
            const extension = videoUrl.split('.').pop().split(/[#?]/)[0];
            const videoType = `video/${
                extension === 'mp4' ? 'mp4' :
                extension === 'webm' ? 'webm' :
                extension === 'ogg' ? 'ogg' : 'mp4'
            }`;
            
            source.type = videoType;
            video.appendChild(source);
            
            video.innerHTML += 'Ваш браузер не поддерживает видео тег.';
            playerContainer.appendChild(video);
            
            // Обработчик ошибок загрузки видео
            video.addEventListener('error', () => {
                const error = document.createElement('div');
                error.className = 'error';
                error.textContent = 'Ошибка загрузки видео. Проверьте:';
                error.innerHTML += '<ul>'
                    + '<li>Корректность ссылки</li>'
                    + '<li>Настройки CORS на сервере с видео</li>'
                    + '<li>Формат видео (поддерживаются MP4, WebM, Ogg)</li>'
                    + '</ul>';
                playerContainer.appendChild(error);
            });
            
        } else {
            // Сообщение об отсутствии параметра
            const error = document.createElement('div');
            error.className = 'error';
            error.innerHTML = 'Не указана ссылка на видео.<br>Пример использования:'
                + '<code>https://ваш-сайт/?url=https://example.com/video.mp4?параметры</code>'
                + '<br>Обязательно кодируйте специальные символы в URL!';
            playerContainer.appendChild(error);
        }
    </script>
    
    <!-- Предупреждение о CORS -->
    <div class="error">
        Примечание: Видео может не загружаться из-за CORS-политики удаленного сервера.<br>
        Для работы плеера сервер с видео должен разрешать кросс-доменные запросы.
    </div>
</body>
</html>
